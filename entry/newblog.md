# ブログ作り直した

仕事に追われてるうちに気づいたらブログが落ちていて、  
作ったのも随分昔だし直すよか作り直すかということで作り直した。

ソースコードは github で公開しているので  
気が向いた人は読むなり使うなりするといいと思うよ。

## meta

- slug: newblog
- date: 2015-12-13 10:00
- tags: blog,js
- active: true

## content

## 構成

このブログは下図のような構成で出来ている。

特定の場所に置いた md を元に JSON を生成して S3に。  
AWS の Lambda と API Gateway でリスト系 API を生成して必要があれば Dynamo に格納。  
CloudFront と言いたいところだけど個人ブログだし EC2 においた nginx でまとめ上げて配信。  
どこまで効果あるか知らんけど遊び半分で HTTP/2 で配信してるよ。  
実際 S3 においてる json をプロキシしてるのでその辺りはあんまり意味が無いので次の日ぐらいには  
しれっと ec2 の中に戻してるかもしれない。

フロントは API を読んで頑張りまくりつつ、ページ間遷移は pushState でほげらったしてる。  
pushState なルーティングはいつものやつ使ってる。

長くなりそうなのでフロントの詳しいことは別の機会にでも書く。

## Markdown to JSON

前々から Markdown で荒く書いたデータ構造をとりあえず乱暴でいいので JSON にしてくれたらなんか楽なんだけどなぁと思っていたら  
MSON とかいう規格？を APIary が提唱していたので乗っかってみた。

実装系を探したのだけれど、issue で飛び交ってたライブラいまいちだったので簡易的なパーサーを組んだ。

別に MSON パーサー実装したぜ！と名乗る気も付き合う気もないし、  
自分に必要な所だけ自分の都合のいいように解釈して実装しているので書いてある仕様通りではないしただの劣化パクリに成り下がってる感は否めないが向こうは API BluePrint、こちらはなんか物書きようなのでまぁいいだろう。

一応これも READNE でシンタックスを紹介してるのと、記事の元になってる md 自体公開してるので気になる人は読んでほしい。

## 第三世代型 API 吐き出しブログツール

は、煽りすぎた。うそうそ。  
としても。  
すべてを API 化しているので、特定の場所に md を置く、  
何かしらの手段でアクションを検知してコンパイラを起動するという条件さえクリアしてしまえば、  
クライアントになるものはなんでもいいこと、フロントは飽きたらすぐ変えられるマンスリー賃貸みたいな物件になっている。

まぁ今後こういうほとんどフロントオンリーでリーズナブル(謎)なツールはそれなりに増えていくんじゃないかな。

md の置き場所も暫定的には github にしているが dropbox とかでもいいしそのあたりは動かしながら考えていこう。

ファイル更新の hook さえ飛べばそれでいいのだ。


使ってやろうとかいう奇特な人はコミットしてないけど config.json に  
関連するサービスやツールのアクセスキーやらを書く必要があるので READMEを参考に自分で書いてちょ。

とりあえず記事が書ければいいのでバックエンドは仕事のビルド待ち時間を使って3日くらいでちゃっちゃか仕上げた。

フロントはモデルとテンプレートエンジンを頑張ったりしたので結局もうちょっと時間かかった。  
前述の通り、  
気が変わらなければそのうち頑張ったぞいアピールを書こうと思う。
