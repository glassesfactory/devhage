# ブログ作り直した

仕事に追われてるうちに気づいたらブログが落ちていて、  
作ったのも随分昔だし直すよか作り直すかということで作り直した。  
feed が飛んでるので懲りずにとってた人には検知されてるかもしれない(誰)

ソースコードは [github](https://github.com/glassesfactory/devhage) で公開しているので(書いてる時点ではまだしてない)  
気が向いた人は読むなり使うなりするといいと思うよ。

古い記事はこれから入れ込んでくつもり。

## meta

- slug: newblog
- date: 2015-12-13 10:00
- tags: blog,js
- active: true

## content

## 構成

このブログは下図のような構成で出来ている。

特定の場所に置いた md を元に JSON を生成して S3に。  
しようかと思ったけど nginx + HTTP/2 での配信のほうが速かったのでそっちに変えた。
md をパースした結果を DynamoDB にも保存しつつ、 nginx にもうけた hook ポイントに post して、  
lua で json の中身を静的ファイルとして生成して ec2 内のストレージに保存してるよ。  
この仕組は後日。

リスト系 API は DynamoDB に格納したデータを元に Lambda と API Gateway で。  

フロントは API を読んで頑張りまくりつつ、ページ間遷移は pushState でほげらったしてる。  
pushState なルーティングはいつものやつ使ってる。

長くなりそうなのでフロントの詳しいことも別の機会に書く。

## Markdown to JSON

前々から Markdown で荒く書いたデータ構造をとりあえず乱暴でいいので JSON にしてくれたらなんか楽なんだけどなぁと思っていたら  
MSON とかいう規格？を APIary が提唱していたので乗っかってみた。

実装系を探したのだけれど、issue で飛び交ってたライブラいまいちだったので簡易的なパーサーを組んだ。

別に MSON パーサー実装したぜ！と名乗る気も付き合う気もないし、  
自分に必要な所だけ自分の都合のいいように解釈して実装しているので書いてある仕様通りではないしただの劣化パクリに成り下がってる感は否めないが向こうは API BluePrint、こちらはなんか物書きようなのでまぁいいだろう。

一応これも READNE でシンタックスを紹介してるのと、記事の元になってる md 自体公開してるので気になる人は読んでほしい。

## 第三世代型 API 吐き出しブログツール

は、煽りすぎた。うそうそ。  
としても。  
すべてを API 化しているので、特定の場所に md を置く、  
何かしらの手段でアクションを検知してコンパイラを起動するという条件さえクリアしてしまえば、  
クライアントになるものはなんでもいいこと、フロントは飽きたらすぐ変えられるマンスリー賃貸みたいな物件になっている。
記事データ取得、生成、保存、配信の殆どをそれぞれ小規模な Lambda スクリプトで実現しているので、  
大げさなドキュメントを読む必要もなく、都合に合わせて挿げ替えがいくらでもできるのは再利用性が高くていいんじゃなかろうか。

まぁ今後こういうほとんどフロントオンリーでリーズナブル(謎)なツールはそれなりに増えていくんじゃないかな。(偉そう)

md の置き場所も暫定的には github にしているが dropbox とかでもいいしそのあたりは動かしながら考えていこう。
Evernote は…まぁ考えておく。

最低限、ファイル更新の hook さえ飛べばなんとかなる。


使ってやろうとかいう奇特な人はコミットしてないけど config.json に  
関連するサービスやツールのアクセスキーやらを書く必要があるので README を参考に自分で書いてちょ。

とりあえず記事が書ければいいのでバックエンドは仕事のビルド待ち時間を使って3日くらいでちゃっちゃか仕上げるつもりが、
途中で現在進行形で仕事で必要な技術が出てきたのでそっちへのコミットを含みつつ書いてたらもうちょいかかった。

フロントは寝て起きたらできてた。  
前述の通り、  
気が変わらなければそのうち頑張ったぞいアピールを書こうと思う。
